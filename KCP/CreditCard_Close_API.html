<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://www.newebpay.com/images/head.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://www.newebpay.com/images/head.ico" type="image/x-icon">    
    <title data-i18n="page_title"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        html { scroll-behavior: smooth; }
        body { background-color: #f8fafc; }
        
        /* Custom Scrollbar */
        .scrollable-area::-webkit-scrollbar { width: 6px; }
        .scrollable-area::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        
        /* Navigation Active State */
        .sidebar-active { background-color: #e0f2fe; color: #0284c7; border-right: 4px solid #0284c7; font-weight: 600; }
        
        /* Tabs */
        .tab-btn { border-bottom: 2px solid transparent; transition: all 0.3s; }
        .tab-btn:hover { color: #60a5fa; }
        .tab-btn.active { border-bottom-color: #3b82f6; color: #3b82f6; font-weight: 600; background-color: rgba(59, 130, 246, 0.05); }
        
        /* Table Styles */
        .params-table th { background-color: #f1f5f9; color: #475569; font-weight: 700; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.05em; }
        .params-table td { vertical-align: top; color: #334155; }
        .params-table tr:hover { background-color: #f8fafc; }

        /* Tool styles */
        .tool-tab-btn { transition: all 0.2s; }
        .tool-tab-btn.active { border-bottom-color: #9333ea; color: #9333ea; background-color: #faf5ff; }
    </style>
</head>
<body class="text-slate-800 font-sans">

    <!-- Mobile Header -->
    <header class="lg:hidden bg-white shadow-sm p-4 sticky top-0 z-50 flex justify-between items-center border-b border-slate-200">
        <h1 class="text-lg font-bold text-blue-700 flex items-center">
            <i class="fas fa-hand-holding-usd mr-2"></i> <span data-i18n="header_mobile_title"></span>
        </h1>
        <button id="menu-btn" class="text-slate-600 focus:outline-none hover:text-blue-600 transition">
            <i class="fas fa-bars text-2xl"></i>
        </button>
    </header>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white shadow-xl transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 border-r border-slate-200 flex flex-col">
            
            <!-- Top Section -->
            <div class="p-6 border-b border-slate-100 bg-gradient-to-r from-blue-50 to-white shrink-0">
                <h2 class="text-2xl font-bold text-blue-700 tracking-tight" data-i18n="sidebar_brand"></h2>
                <p class="text-sm text-slate-500 mt-1 font-medium"><span data-i18n="sidebar_subtitle"></span><br><span class="text-xs text-slate-400" data-i18n="sidebar_version_note"></span></p>
                
                <div class="mt-4">
                    <div class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full inline-block font-mono font-semibold">Ver: 1.1</div>
                </div>
            </div>

            <!-- Scrollable Navigation Area -->
            <div class="flex-1 overflow-y-auto scrollable-area">
                <nav class="p-4 space-y-1">
                    <a href="#intro" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-info-circle w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_intro"></span>
                    </a>
                    <a href="#setup" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-cogs w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_setup"></span>
                    </a>
                    <a href="#tool" class="nav-link block px-4 py-3 text-sm text-purple-700 bg-purple-50 hover:bg-purple-100 hover:text-purple-800 rounded-lg transition-colors group border border-purple-100 mb-4 shadow-sm">
                        <i class="fas fa-wrench w-6 group-hover:text-purple-600 transition-colors"></i> <span data-i18n="nav_tool"></span>
                    </a>
                    <div class="px-4 py-2 text-xs font-bold text-slate-400 uppercase tracking-wider mt-4" data-i18n="nav_group_api"></div>
                    <a href="#request" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-paper-plane w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_request"></span>
                    </a>
                    <!-- 新增加密規則連結 -->
                    <a href="#encryption" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-lock w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_encryption"></span>
                    </a>
                    <a href="#response" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-reply w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_response"></span>
                    </a>
                    <a href="#errors" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-exclamation-triangle w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_errors"></span>
                    </a>
                    <a href="#example" class="nav-link block px-4 py-3 text-sm text-slate-600 hover:bg-slate-50 hover:text-blue-600 rounded-lg transition-colors group">
                        <i class="fas fa-code w-6 group-hover:text-blue-500 transition-colors"></i> <span data-i18n="nav_example"></span>
                    </a>
                </nav>
            </div>

            <!-- Footer with Language Switcher -->
            <div class="p-4 border-t border-slate-200 bg-slate-50 shrink-0">
                <div class="relative group w-full">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-slate-400">
                        <i class="fas fa-globe"></i>
                    </div>
                    <select id="lang-select" onchange="changeLang(this.value)" class="w-full appearance-none bg-white hover:bg-white text-slate-600 font-medium py-2.5 pl-10 pr-8 rounded-lg text-sm transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer border border-slate-300 hover:border-blue-400 shadow-sm">
                        <!-- Options injected by JS -->
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-slate-500 group-hover:text-slate-700">
                        <i class="fas fa-chevron-up text-xs"></i>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 lg:ml-72 p-4 lg:p-8 w-[95%] mx-auto max-w-[1920px]">
            
            <!-- Intro -->
            <section id="intro" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h1 class="text-3xl font-bold text-slate-900" data-i18n="intro_title"></h1>
                </div>
                
                <div class="bg-white p-6 lg:p-8 rounded-xl shadow-sm border border-slate-200">
                    <p class="text-slate-700 leading-relaxed mb-6 text-lg" data-i18n="intro_desc"></p>
                    
                    <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                        <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center text-sm mr-2"><i class="fas fa-list-ul"></i></span> 
                        <span data-i18n="intro_funcs_title"></span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                            <i class="fas fa-money-bill-wave text-2xl text-green-600 mb-2"></i>
                            <h4 class="font-bold text-slate-700" data-i18n="card_capture_title"></h4>
                            <p class="text-xs text-slate-500 mt-1">Capture</p>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                            <i class="fas fa-undo text-2xl text-red-500 mb-2"></i>
                            <h4 class="font-bold text-slate-700" data-i18n="card_refund_title"></h4>
                            <p class="text-xs text-slate-500 mt-1">Refund</p>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                            <i class="fas fa-ban text-2xl text-orange-500 mb-2"></i>
                            <h4 class="font-bold text-slate-700" data-i18n="card_cancel_capture_title"></h4>
                            <p class="text-xs text-slate-500 mt-1">Cancel Capture</p>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                            <i class="fas fa-history text-2xl text-gray-500 mb-2"></i>
                            <h4 class="font-bold text-slate-700" data-i18n="card_cancel_refund_title"></h4>
                            <p class="text-xs text-slate-500 mt-1">Cancel Refund</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Setup -->
            <section id="setup" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="setup_title"></h2>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div class="p-4 bg-slate-50 rounded-lg border border-slate-100">
                            <h3 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-key text-blue-500 mr-2"></i> <span data-i18n="setup_card1_title"></span></h3>
                            <p class="text-sm text-slate-600" data-i18n="setup_card1_desc"></p>
                        </div>
                        <div class="p-4 bg-slate-50 rounded-lg border border-slate-100">
                            <h3 class="font-bold text-slate-800 mb-2 flex items-center"><i class="fas fa-network-wired text-blue-500 mr-2"></i> <span data-i18n="setup_card2_title"></span></h3>
                            <p class="text-sm text-slate-600" data-i18n="setup_card2_desc"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tool -->
             <section id="tool" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-purple-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="tool_title"></h2>
                </div>
                
                <div class="bg-white rounded-xl shadow-md border border-purple-100 overflow-hidden">
                    <div class="bg-purple-50 p-4 border-b border-purple-100">
                        <p class="text-purple-800 text-sm" data-i18n="tool_intro"></p>
                    </div>

                    <div class="flex border-b border-slate-200">
                        <button onclick="switchToolTab('aes-encrypt')" class="tool-tab-btn active flex-1 py-4 text-sm font-bold text-center hover:bg-slate-50 transition border-b-2 border-purple-600 text-purple-600">
                            <i class="fas fa-lock mr-2"></i> <span data-i18n="tool_tab_encrypt"></span>
                        </button>
                        <button onclick="switchToolTab('aes-decrypt')" class="tool-tab-btn flex-1 py-4 text-sm font-bold text-center hover:bg-slate-50 transition border-b-2 border-transparent text-slate-500">
                            <i class="fas fa-unlock mr-2"></i> <span data-i18n="tool_tab_decrypt"></span>
                        </button>
                    </div>

                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 pb-6 border-b border-slate-100">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Hash Key (32 bytes)</label>
                                <input type="text" id="toolKey" data-i18n-placeholder="tool_ph_key" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-purple-500 font-mono text-sm bg-slate-50">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Hash IV (16 bytes)</label>
                                <input type="text" id="toolIv" data-i18n-placeholder="tool_ph_iv" class="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-purple-500 font-mono text-sm bg-slate-50">
                            </div>
                        </div>

                        <div id="aes-encrypt" class="tool-content active">
                            <div class="mb-4">
                                <label class="block text-sm font-bold text-slate-700 mb-2" data-i18n="tool_lbl_qs"></label>
                                <textarea id="encryptInput" rows="5" data-i18n-placeholder="tool_ph_qs" class="w-full p-3 border border-slate-300 rounded focus:ring-2 focus:ring-purple-500 font-mono text-sm text-slate-600"></textarea>
                                <p class="text-xs text-slate-400 mt-1 text-right" data-i18n="tool_note_urlencode"></p>
                            </div>
                            <button onclick="runEncrypt()" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition shadow-sm font-bold text-sm">
                                <i class="fas fa-arrow-down mr-1"></i> <span data-i18n="tool_btn_encrypt"></span>
                            </button>
                            <div class="mt-4">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1" data-i18n="tool_lbl_hex"></label>
                                <div class="relative">
                                    <textarea id="encryptOutput" readonly rows="3" class="w-full p-3 bg-slate-800 text-green-400 rounded font-mono text-sm border-none focus:ring-0"></textarea>
                                </div>
                            </div>
                        </div>

                        <div id="aes-decrypt" class="tool-content hidden">
                             <div class="mb-4">
                                <label class="block text-sm font-bold text-slate-700 mb-2" data-i18n="tool_lbl_enc_hex"></label>
                                <textarea id="decryptInput" rows="4" data-i18n-placeholder="tool_ph_enc_hex" class="w-full p-3 border border-slate-300 rounded focus:ring-2 focus:ring-purple-500 font-mono text-sm text-slate-600"></textarea>
                            </div>
                            <button onclick="runDecrypt()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition shadow-sm font-bold text-sm">
                                <i class="fas fa-arrow-down mr-1"></i> <span data-i18n="tool_btn_decrypt"></span>
                            </button>
                            <div class="mt-4">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1" data-i18n="tool_lbl_decrypt_res"></label>
                                <div class="relative">
                                    <textarea id="decryptOutput" readonly rows="3" class="w-full p-3 bg-slate-800 text-green-400 rounded font-mono text-sm border-none focus:ring-0"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Request -->
            <section id="request" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="req_title"></h2>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 border-l-4 border-blue-500 pl-3" data-i18n="req_api_info"></h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded border border-slate-100">
                            <div class="text-xs text-slate-500 uppercase mb-1">Method</div>
                            <div class="font-mono font-bold text-green-600 text-lg">POST</div>
                        </div>
                        <div class="bg-slate-50 p-3 rounded border border-slate-100 md:col-span-2">
                            <div class="flex flex-col space-y-2">
                                <div>
                                    <div class="text-xs text-slate-500 uppercase mb-1" data-i18n="req_url_prod"></div>
                                    <div class="font-mono text-blue-600 select-all font-medium">https://core.newebpay.com/API/CreditCard/Close</div>
                                </div>
                                <div class="border-t border-slate-200 pt-2">
                                    <div class="text-xs text-slate-500 uppercase mb-1" data-i18n="req_url_test"></div>
                                    <div class="font-mono text-slate-500 select-all">https://ccore.newebpay.com/API/CreditCard/Close</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Level 1 Params -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                    <div class="p-4 bg-slate-100 border-b border-slate-200">
                        <h3 class="font-bold text-slate-700" data-i18n="req_lvl1_title"></h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm params-table">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th class="px-6 py-4 w-1/6" data-i18n="th_param"></th>
                                    <th class="px-6 py-4 w-1/6" data-i18n="th_name"></th>
                                    <th class="px-6 py-4 w-24 text-center" data-i18n="th_required"></th>
                                    <th class="px-6 py-4" data-i18n="th_type"></th>
                                    <th class="px-6 py-4 w-1/3" data-i18n="th_note"></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-6 py-4 font-mono font-bold text-blue-600">MerchantID_</td>
                                    <td class="px-6 py-4" data-i18n="param_mid_name"></td>
                                    <td class="px-6 py-4 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-4 font-mono text-xs">String(15)</td>
                                    <td class="px-6 py-4" data-i18n="param_mid_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 font-mono font-bold text-blue-600">PostData_</td>
                                    <td class="px-6 py-4" data-i18n="param_post_name"></td>
                                    <td class="px-6 py-4 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-4 font-mono text-xs">text</td>
                                    <td class="px-6 py-4" data-i18n="param_post_note"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Level 2 Params -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-slate-100 border-b border-slate-200 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700" data-i18n="req_lvl2_title"></h3>
                        <span class="text-xs text-slate-500 bg-white px-2 py-1 rounded border">AES-256-CBC Encrypted</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm params-table">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th class="px-6 py-4 w-32" data-i18n="th_param"></th>
                                    <th class="px-6 py-4 w-32" data-i18n="th_name"></th>
                                    <th class="px-6 py-4 w-16 text-center" data-i18n="th_required"></th>
                                    <th class="px-6 py-4 w-24" data-i18n="th_type"></th>
                                    <th class="px-6 py-4" data-i18n="th_note"></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">RespondType</td>
                                    <td class="px-6 py-3" data-i18n="p_respt_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(5)</td>
                                    <td class="px-6 py-3" data-i18n="p_respt_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">Version</td>
                                    <td class="px-6 py-3" data-i18n="p_ver_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(5)</td>
                                    <td class="px-6 py-3" data-i18n="p_ver_note"></td>
                                </tr>
                                <tr class="bg-yellow-50">
                                    <td class="px-6 py-3 font-mono font-bold text-blue-700">Amt</td>
                                    <td class="px-6 py-3 font-bold text-blue-900" data-i18n="p_amt_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">Int(10)</td>
                                    <td class="px-6 py-3 font-medium text-slate-800" data-i18n="p_amt_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">MerchantOrderNo</td>
                                    <td class="px-6 py-3" data-i18n="p_ord_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(30)</td>
                                    <td class="px-6 py-3" data-i18n="p_ord_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">TimeStamp</td>
                                    <td class="px-6 py-3" data-i18n="p_ts_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(30)</td>
                                    <td class="px-6 py-3" data-i18n="p_ts_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">IndexType</td>
                                    <td class="px-6 py-3" data-i18n="p_idx_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">Int(1)</td>
                                    <td class="px-6 py-3" data-i18n="p_idx_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">TradeNo</td>
                                    <td class="px-6 py-3" data-i18n="p_trade_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(20)</td>
                                    <td class="px-6 py-3" data-i18n="p_trade_note"></td>
                                </tr>
                                <tr class="bg-blue-50">
                                    <td class="px-6 py-3 font-mono font-bold text-blue-700">CloseType</td>
                                    <td class="px-6 py-3 font-bold text-blue-900" data-i18n="p_close_name"></td>
                                    <td class="px-6 py-3 text-center text-green-600"><i class="fas fa-check"></i></td>
                                    <td class="px-6 py-3 font-mono text-xs">Int(1)</td>
                                    <td class="px-6 py-3 font-medium text-slate-800" data-i18n="p_close_note"></td>
                                </tr>
                                <tr class="bg-blue-50">
                                    <td class="px-6 py-3 font-mono font-bold text-blue-700">Cancel</td>
                                    <td class="px-6 py-3 font-bold text-blue-900" data-i18n="p_cancel_name"></td>
                                    <td class="px-6 py-3 text-center text-slate-400"></td>
                                    <td class="px-6 py-3 font-mono text-xs">Int(1)</td>
                                    <td class="px-6 py-3 font-medium text-slate-800" data-i18n="p_cancel_note"></td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-3 font-mono font-medium">ProcessNo</td>
                                    <td class="px-6 py-3" data-i18n="p_proc_name"></td>
                                    <td class="px-6 py-3 text-center text-slate-400"></td>
                                    <td class="px-6 py-3 font-mono text-xs">String(30)</td>
                                    <td class="px-6 py-3" data-i18n="p_proc_note"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- 新增 Encryption Rules Section -->
            <section id="encryption" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="enc_title"></h2>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                    <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                        <span class="w-6 h-6 bg-blue-100 text-blue-600 rounded flex items-center justify-center text-xs mr-2"><i class="fas fa-lock"></i></span>
                        <span data-i18n="enc_aes_title"></span>
                    </h3>
                    <p class="text-slate-600 mb-4" data-i18n="enc_aes_desc"></p>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 space-y-4">
                        <div class="flex">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">1</div>
                            <div class="ml-4">
                                <h4 class="font-bold text-slate-800" data-i18n="enc_step1_title"></h4>
                                <p class="text-sm text-slate-600 mt-1" data-i18n="enc_step1_desc"></p>
                                <code class="block bg-slate-800 text-slate-300 p-2 rounded mt-2 text-xs font-mono">RespondType=JSON&Version=1.1&Amt=1000&MerchantOrderNo=ORD12345&...</code>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">2</div>
                            <div class="ml-4">
                                <h4 class="font-bold text-slate-800" data-i18n="enc_step2_title"></h4>
                                <p class="text-sm text-slate-600 mt-1" data-i18n="enc_step2_desc"></p>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="flex-shrink-0 w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">3</div>
                            <div class="ml-4">
                                <h4 class="font-bold text-slate-800" data-i18n="enc_step3_title"></h4>
                                <p class="text-sm text-slate-600 mt-1" data-i18n="enc_step3_desc"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Response -->
            <section id="response" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="res_title"></h2>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-6">
                    <p class="text-slate-600 mb-4" data-i18n="res_desc"></p>
                    <table class="w-full text-left text-sm mb-6 border border-slate-200">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-4 py-2 border-b" data-i18n="th_param"></th>
                                <th class="px-4 py-2 border-b" data-i18n="th_name"></th>
                                <th class="px-4 py-2 border-b" data-i18n="th_note"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="px-4 py-2 border-b font-mono font-bold text-blue-600">Status</td>
                                <td class="px-4 py-2 border-b" data-i18n="res_status_name"></td>
                                <td class="px-4 py-2 border-b" data-i18n="res_status_note"></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 border-b font-mono font-bold text-blue-600">Message</td>
                                <td class="px-4 py-2 border-b" data-i18n="res_msg_name"></td>
                                <td class="px-4 py-2 border-b" data-i18n="res_msg_note"></td>
                            </tr>
                            <tr>
                                <td class="px-4 py-2 border-b font-mono font-bold text-blue-600">Result</td>
                                <td class="px-4 py-2 border-b" data-i18n="res_result_name"></td>
                                <td class="px-4 py-2 border-b" data-i18n="res_result_note"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-4 bg-slate-100 border-b border-slate-200">
                        <h3 class="font-bold text-slate-700" data-i18n="res_obj_title"></h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm params-table">
                             <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th class="px-6 py-4 w-32" data-i18n="th_param"></th>
                                    <th class="px-6 py-4 w-32" data-i18n="th_name"></th>
                                    <th class="px-6 py-4 w-24" data-i18n="th_type"></th>
                                    <th class="px-6 py-4" data-i18n="th_note"></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr><td class="px-6 py-3 font-mono font-bold">MerchantID</td><td class="px-6 py-3" data-i18n="res_mid_name"></td><td class="px-6 py-3 font-mono text-xs">String(15)</td><td class="px-6 py-3" data-i18n="res_mid_note"></td></tr>
                                <tr><td class="px-6 py-3 font-mono font-bold">Amt</td><td class="px-6 py-3" data-i18n="res_amt_name"></td><td class="px-6 py-3 font-mono text-xs">Int(10)</td><td class="px-6 py-3" data-i18n="res_amt_note"></td></tr>
                                <tr><td class="px-6 py-3 font-mono font-bold">TradeNo</td><td class="px-6 py-3" data-i18n="res_trade_name"></td><td class="px-6 py-3 font-mono text-xs">String(20)</td><td class="px-6 py-3" data-i18n="res_trade_note"></td></tr>
                                <tr><td class="px-6 py-3 font-mono font-bold">MerchantOrderNo</td><td class="px-6 py-3" data-i18n="res_ord_name"></td><td class="px-6 py-3 font-mono text-xs">String(30)</td><td class="px-6 py-3" data-i18n="res_ord_note"></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

             <!-- Errors -->
             <section id="errors" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="err_title"></h2>
                </div>
                
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-4">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-3.5 text-slate-400"></i>
                        <input type="text" id="errorSearch" data-i18n-placeholder="err_search_ph" class="w-full pl-10 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
                <div class="overflow-x-auto bg-white rounded-xl shadow-sm border border-slate-200 max-h-[600px] overflow-y-auto">
                    <table class="w-full text-left text-sm" id="errorTable">
                        <thead class="bg-slate-50 text-slate-600 uppercase font-bold sticky top-0 border-b border-slate-200 shadow-sm">
                            <tr>
                                <th class="px-6 py-4 w-1/4" data-i18n="th_err_code"></th>
                                <th class="px-6 py-4" data-i18n="th_err_reason"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200 font-mono text-slate-700">
                             <!-- Dynamic Generation -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Example -->
            <section id="example" class="mb-12 scroll-mt-24">
                <div class="flex items-center mb-6">
                    <div class="w-2 h-8 bg-blue-600 mr-4 rounded-sm"></div>
                    <h2 class="text-2xl font-bold text-slate-900" data-i18n="example_title"></h2>
                </div>
                
                <div class="bg-slate-800 rounded-lg shadow-lg overflow-hidden relative">
                    <div class="flex border-b border-slate-600 bg-slate-900 px-2">
                        <button onclick="switchTab('php', event)" class="tab-btn active px-6 py-3 text-sm font-medium text-slate-300 hover:text-white transition-colors">PHP</button>
                        <button onclick="switchTab('nodejs', event)" class="tab-btn px-6 py-3 text-sm font-medium text-slate-300 hover:text-white transition-colors">Node.js</button>
                        <button onclick="switchTab('python', event)" class="tab-btn px-6 py-3 text-sm font-medium text-slate-300 hover:text-white transition-colors">Python</button>
                        <button onclick="switchTab('csharp', event)" class="tab-btn px-6 py-3 text-sm font-medium text-slate-300 hover:text-white transition-colors">C# (.NET)</button>
                    </div>

                    <textarea id="code-display" readonly class="w-full h-[600px] p-4 bg-[#272822] text-[#f8f8f2] font-mono text-sm leading-6 border-none outline-none resize-none"></textarea>
                </div>
            </section>

        </main>
    </div>

    <script>
        // Multi-language configuration
        const langData = {
            'zh-TW': { name: '繁體中文', data: { page_title: '藍新金流 - 信用卡請退款/取消 API 文件', header_mobile_title: '請退款 API 文件', sidebar_brand: 'NewebPay', sidebar_subtitle: '信用卡請退款 API', sidebar_version_note: '(CreditCard/Close)', nav_intro: '簡介與功能', nav_setup: '串接前置準備', nav_tool: '加密測試工具', nav_group_api: 'API 規格', nav_request: '請求參數 (Request)', nav_encryption: '加密規則詳解', nav_response: '回應參數 (Response)', nav_errors: '錯誤代碼表', nav_example: '範例程式碼', intro_title: '簡介與功能', intro_desc: '此 API (Close API) 提供商店針對已授權的信用卡交易進行後續處理。共支援四種功能：信用卡請款、信用卡退款、信用卡取消請款、以及信用卡取消退款。透過不同的參數組合 (CloseType 與 Cancel) 來決定執行的動作。', intro_funcs_title: '支援功能', card_capture_title: '信用卡 請款', card_refund_title: '信用卡 退款', card_cancel_capture_title: '信用卡 取消請款', card_cancel_refund_title: '信用卡 取消退款', setup_title: '串接前置準備', setup_card1_title: '取得金鑰', setup_card1_desc: '須於藍新金流會員專區取得商店代號 (MerchantID) 以及對應的 <code>Hash Key</code> 與 <code>Hash IV</code>。', setup_card2_title: '確認網址', setup_card2_desc: '測試環境：https://ccore.newebpay.com/API/CreditCard/Close<br>正式環境：https://core.newebpay.com/API/CreditCard/Close', tool_title: '加密測試工具', tool_intro: '此工具可協助您產生 PostData_ 加密字串，或解密回傳結果。', tool_tab_encrypt: 'AES 加密 (Request)', tool_tab_decrypt: 'AES 解密 (Response)', tool_ph_key: '例如: AAAAvw3YlqoEk6G4HqRKDAYpHKZWxBBB', tool_ph_iv: '例如: AAAACC1FplieBBBB', tool_lbl_qs: '原始請求字串 (Query String)', tool_ph_qs: '例如: RespondType=JSON&Version=1.1&Amt=30&MerchantOrderNo=ORD12345&TimeStamp=1400137200&IndexType=1&CloseType=1', tool_note_urlencode: '請確認字串已經過 http_build_query 或 urlencode 處理', tool_btn_encrypt: '執行加密產生 PostData_', tool_lbl_hex: '加密結果 (Hex String)', tool_lbl_enc_hex: '加密字串 (Hex String)', tool_ph_enc_hex: '例如: 0ef82edabaf8964d09992d7ec8e575f1...', tool_btn_decrypt: '執行解密', tool_lbl_decrypt_res: '解密結果 (原始資料)', req_title: '請求參數 (Request)', req_api_info: 'API 資訊', req_url_prod: 'URL (正式環境)', req_url_test: 'URL (測試環境)', req_lvl1_title: '第一層參數 (HTML Form Post)', th_param: '參數名稱', th_name: '中文名稱', th_required: '必填', th_type: '型態', th_note: '備註', param_mid_name: '商店代號', param_mid_note: '藍新金流商店代號。', param_post_name: '加密資料', param_post_note: '將參數串接後，使用 AES-256-CBC 加密並轉為 Hex 字串。', req_lvl2_title: 'PostData_ 內含參數 (加密前)', p_respt_name: '回傳格式', p_respt_note: '請填入 <code class="bg-slate-100 px-1">JSON</code> 。', p_ver_name: '串接程式版本', p_ver_note: '請固定填入 <code class="bg-slate-100 px-1">1.1</code>。', p_amt_name: '請退款金額', p_amt_note: '1. 純數字不含符號。<br>2. <b>一次付清 (含三大Pay/國外卡)</b>：可整筆及部分金額請款及退款。<br>3. <b>分期付款及紅利折抵</b>：僅可<span class="text-red-600 font-bold">整筆</span>金額請款及退款。<br>4. <b>銀聯卡</b>：僅可整筆金額請款，但可整筆及部分金額退款。', p_ord_name: '商店訂單編號', p_ord_note: '1. 同一商店中此編號不可重覆。<br>2. 只接受英文或數字與底線。', p_ts_name: '時間戳記', p_ts_note: 'Unix 時間戳記 (秒)。<br><span class="text-red-600">※ 須確實帶入當前時間，容許誤差值 120 秒，否則會交易失敗。</span>', p_idx_name: '選用單號類別', p_idx_note: '<b>1</b>：代表選用商店訂單編號 (MerchantOrderNo)<br><b>2</b>：代表選用藍新金流交易序號 (TradeNo)<br>※ 當選用其中一種單號類別時，該種單號不可空白。', p_trade_name: '藍新金流交易序號', p_trade_note: '藍新金流平台交易序號 (若 IndexType=2 則必填)。', p_close_note: '<b>1</b>：請款 (Capture) 或 取消請款。<br><b>2</b>：退款 (Refund) 或 取消退款。', p_close_name: '請款或退款', p_cancel_name: '取消動作', p_cancel_note: '若欲發動<b>取消請款</b>或<b>取消退款</b>時，此欄請填 <b>1</b>。<br>(若為一般請款或退款，此欄請留空)。', p_proc_name: '商店自訂作業編號', p_proc_note: '商店可為此次作業自訂一個作業編號。', enc_title: '加密規則詳解', enc_aes_title: 'AES 加解密機制 (PostData_)', enc_aes_desc: '為防止重要交易訊息洩漏，需於加密前使用商店之 Hash Key 及 Hash IV 對參數字串執行 AES 加密。', enc_step1_title: '生成請求字串', enc_step1_desc: '將所有參數依照 <code>http_build_query</code> 格式組合 (key=value&key2=value2...)。', enc_step2_title: 'AES 加密', enc_step2_desc: '加密演算法：<span class="font-bold text-red-600">AES-256-CBC</span><br>填充模式 (Padding)：<span class="font-bold text-red-600">PKCS7</span><br>Key / IV：請使用商店專屬的 Hash Key 與 Hash IV。', enc_step3_title: '轉十六進制 (Hex)', enc_step3_desc: '將加密後的二進位資料 (Raw Data) 轉換為 Hex String (小寫)，即為 <code>PostData_</code>。', res_title: '回應參數 (Response)', res_desc: '回應資料包含 Status, Message 與 Result (JSON)。', res_status_name: '回傳狀態', res_status_note: '1. 若請退款成功則回傳 <b>SUCCESS</b>。<br>2. 若失敗則回傳錯誤代碼 (請參考錯誤代碼表)。', res_msg_name: '回傳訊息', res_msg_note: '文字，敘述此次請退款訊息。', res_result_name: '回傳資料', res_result_note: 'JSON 格式，內含詳細資訊。', res_obj_title: 'Result 物件內含參數', res_mid_name: '商店代號', res_mid_note: '商店代號', res_amt_name: '請退款金額', res_amt_note: '本次交易請退款金額', res_trade_name: '藍新金流交易序號', res_trade_note: '藍新金流平台交易序號', res_ord_name: '商店訂單編號', res_ord_note: '商店訂單編號', err_title: '錯誤代碼表', err_search_ph: '搜尋代碼 (例如: TRA10039) 或 錯誤原因...', th_err_code: '錯誤代碼', th_err_reason: '錯誤原因 / 備註', err_MPG01002: '時間戳記不可空白 (TimeStamp)', err_MPG01009: '商店代號不可空白 (MerchantID)', err_MPG01010: '程式版本設定錯誤', err_MPG01011: '回傳規格設定錯誤 (RespondType)', err_MPG01012: '商店訂單編號不可空白/設定錯誤 (MerchantOrderNo：限英數字、底線，長度30字)', err_MPG01023: '交易加密資料不可空白 (TradeInfo/PostData_)', err_MPG01024: '交易加密SHA資料不可空白 (TradeSha)', err_MEM40008: '必填欄位資料不可空白 (會提示空白欄位)', err_MEM40012: '必填欄位資料傳遞錯誤 (PostData_空白)', err_MEM40013: '必填欄位資料不齊全 (會提示空白欄位)', err_MEM40014: '傳送時間錯誤', err_NOR1001: '連線異常', err_TRA10001: '商店資料取得失敗', err_TRA10003: '金額必須為數字', err_TRA10008: '資料加密錯誤 (PostData_ 解密失敗)', err_TRA10009: '商店代號不可空白', err_TRA10012: '商店代號停用', err_TRA10013: '商店信用卡資格停用', err_TRA10015: '網路連線失敗', err_TRA10018: '資料不足', err_TRA10021: '查無該筆交易或該筆交易不為信用卡交易', err_TRA10026: '此訂單非授權成功狀態，不可請款', err_TRA10027: '此訂單已申請過請款，不可重覆請款', err_TRA10028: '請退款金額超過授權金額，請確認', err_TRA10029: '請款超過授權日N天，已不得請(退)款', err_TRA10030: '請款/退款資料新增失敗模擬信用卡請款失敗', err_TRA10031: '銀聯卡交易只接受全額請退款', err_TRA10032: '單號類型只能為數字1或2 (IndexType)', err_TRA10033: '選擇使用商店自訂單號不可空白', err_TRA10035: '該交易非授權成功或已請款完成狀態，請確認', err_TRA10036: 'RespondType欄位資料格式錯誤已超過剩餘可退款金額，請確認', err_TRA10037: '商家自訂單號錯誤，只允許英數字及_符號', err_TRA10038: '選擇使用系統單號格式錯誤', err_TRA10039: '退款金額已超過請款金額，請確認', err_TRA10045: '該筆交易正在退款中或退款失敗', err_TRA10046: '該筆交易撥款狀態異常，無法執行退款', err_TRA10047: '該交易不為授權成功狀態，不可放棄授權，或該筆交易尚未發動撥款，無法執行退款', err_TRA10048: '該交易正在請款狀態', err_TRA10049: '該交易正在退款狀態', err_TRA10050: '金額不符', err_TRA10058: '動態貨幣轉換交易只接授全額請款', err_TRA10070: '銀聯卡交易無需請款', err_TRA10678: '銀聯卡退款失敗', err_TRA10675: '紅利交易只接授全額請退款', err_TRA10702: '因達到執行請退款筆數上限，您的商店暫時無法使用本功能，請待1小時後解鎖', err_TRA11002: '因失敗過多您的商店暫時無法使用本功能，請待4小時解鎖', err_TRA20001: '金融機構取消授權批次處理中 (此交易取消授權，需由金融機構批次處理)', err_TRA20002: '查無交易資料', err_TRA20004: '商店訂單編號重覆', err_TRA20011: '該筆交易已請款', err_TRA20027: '此訂單已申請過退款，退款中', err_TRA40014: 'TimeStamp欄位錯誤', err_1101: '退款失敗', err_1102: '查無商店', err_1103: '查無訂單資料', err_1104: '訂單狀態不為可退款狀態', err_1105: '可退金額不足', err_1107: '尚未請款', err_1108: '僅支援全額退款', err_1109: '退款交易申請中，請稍後', err_1116: '可退款金額不足，請查看常見問題', err_2100: '最低金額為1 (The Amount minimum is 1)', err_4101: 'EncryptData_ 不可為空白', err_4102: 'HashData_ 不可為空白', err_4103: 'HashData_ 資料檢查不符合', err_4104: '加密資料有誤，請確認Hash_Key與Hash_IV是否正確', err_4105: 'TimeStamp 為空', err_4106: 'UID_ 不可為空白', err_9000: '網路連線失敗', example_title: '範例程式碼' } },
            'EN': { name: 'English', data: { page_title: 'NewebPay - Credit Card Capture/Refund/Cancel API Docs', header_mobile_title: 'Capture/Refund API Docs', sidebar_brand: 'NewebPay', sidebar_subtitle: 'Credit Card Close API', sidebar_version_note: '(CreditCard/Close)', nav_intro: 'Introduction', nav_setup: 'Prerequisites', nav_tool: 'Encryption Tool', nav_group_api: 'API Specs', nav_request: 'Request Parameters', nav_encryption: 'Encryption Details', nav_response: 'Response Parameters', nav_errors: 'Error Codes', nav_example: 'Code Example', intro_title: 'Introduction', intro_desc: 'This API (Close API) allows merchants to process authorized credit card transactions. It supports four functions: Capture, Refund, Cancel Capture, and Cancel Refund. The action is determined by the combination of parameters (CloseType and Cancel).', intro_funcs_title: 'Supported Functions', card_capture_title: 'Credit Card Capture', card_refund_title: 'Credit Card Refund', card_cancel_capture_title: 'Cancel Capture', card_cancel_refund_title: 'Cancel Refund', setup_title: 'Prerequisites', setup_card1_title: 'Get Keys', setup_card1_desc: 'Obtain the MerchantID and the corresponding <code>Hash Key</code> and <code>Hash IV</code> from the NewebPay Merchant Admin.', setup_card2_title: 'Confirm URL', setup_card2_desc: 'Test Env: https://ccore.newebpay.com/API/CreditCard/Close<br>Prod Env: https://core.newebpay.com/API/CreditCard/Close', tool_title: 'Encryption Tool', tool_intro: 'This tool helps you generate the PostData_ encrypted string or decrypt the response result.', tool_tab_encrypt: 'AES Encrypt (Request)', tool_tab_decrypt: 'AES Decrypt (Response)', tool_ph_key: 'Ex: AAAAvw3YlqoEk6G4HqRKDAYpHKZWxBBB', tool_ph_iv: 'Ex: AAAACC1FplieBBBB', tool_lbl_qs: 'Original Query String', tool_ph_qs: 'Ex: RespondType=JSON&Version=1.1&Amt=30&MerchantOrderNo=ORD12345&TimeStamp=1400137200&IndexType=1&CloseType=1', tool_note_urlencode: 'Please ensure the string is processed via http_build_query or urlencode.', tool_btn_encrypt: 'Encrypt to PostData_', tool_lbl_hex: 'Encryption Result (Hex String)', tool_lbl_enc_hex: 'Encrypted String (Hex String)', tool_ph_enc_hex: 'Ex: 0ef82edabaf8964d09992d7ec8e575f1...', tool_btn_decrypt: 'Decrypt', tool_lbl_decrypt_res: 'Decryption Result (Raw Data)', req_title: 'Request Parameters', req_api_info: 'API Info', req_url_prod: 'URL (Production)', req_url_test: 'URL (Test)', req_lvl1_title: 'Level 1 Params (HTML Form Post)', th_param: 'Parameter', th_name: 'Name', th_required: 'Required', th_type: 'Type', th_note: 'Note', param_mid_name: 'Merchant ID', param_mid_note: 'NewebPay Merchant ID.', param_post_name: 'Encrypted Data', param_post_note: 'Concatenate parameters, encrypt using AES-256-CBC, and convert to Hex string.', req_lvl2_title: 'PostData_ Content (Before Encryption)', p_respt_name: 'Response Type', p_respt_note: 'Please enter <code class="bg-slate-100 px-1">JSON</code>.', p_ver_name: 'Version', p_ver_note: 'Please fix to <code class="bg-slate-100 px-1">1.1</code>.', p_amt_name: 'Amount', p_amt_note: '1. Numbers only, no symbols.<br>2. <b>Full Payment (incl. 3 major Pays/Foreign cards)</b>: Full or partial capture/refund allowed.<br>3. <b>Installment & Bonus</b>: Only <span class="text-red-600 font-bold">Full</span> amount capture/refund allowed.<br>4. <b>UnionPay</b>: Full capture only, but allows full or partial refund.', p_ord_name: 'Merchant Order No', p_ord_note: '1. Must be unique within the same merchant.<br>2. Alphanumeric and underscores only.', p_ts_name: 'Timestamp', p_ts_note: 'Unix Timestamp (seconds).<br><span class="text-red-600">※ Must be current time. Tolerance is 120 seconds, otherwise transaction fails.</span>', p_idx_name: 'Index Type', p_idx_note: '<b>1</b>: Use Merchant Order No (MerchantOrderNo)<br><b>2</b>: Use NewebPay Trade No (TradeNo)<br>※ The selected ID type must not be empty.', p_trade_name: 'NewebPay Trade No', p_trade_note: 'NewebPay Platform Trade No (Required if IndexType=2).', p_close_note: '<b>1</b>: Capture or Cancel Capture.<br><b>2</b>: Refund or Cancel Refund.', p_close_name: 'Operation Type', p_cancel_name: 'Cancel Action', p_cancel_note: 'Enter <b>1</b> if you want to <b>Cancel Capture</b> or <b>Cancel Refund</b>.<br>(Leave empty for normal Capture or Refund).', p_proc_name: 'Custom Process No', p_proc_note: 'Merchant can define a process ID for this operation.', enc_title: 'Encryption Details', enc_aes_title: 'AES Mechanism (PostData_)', enc_aes_desc: 'To prevent leakage of important transaction info, use Hash Key and Hash IV to AES encrypt the parameter string.', enc_step1_title: 'Generate Query String', enc_step1_desc: 'Combine all parameters in <code>http_build_query</code> format (key=value&key2=value2...).', enc_step2_title: 'AES Encryption', enc_step2_desc: 'Algorithm: <span class="font-bold text-red-600">AES-256-CBC</span><br>Padding: <span class="font-bold text-red-600">PKCS7</span><br>Key / IV: Use your specific Hash Key and Hash IV.', enc_step3_title: 'Convert to Hex', enc_step3_desc: 'Convert the encrypted binary (Raw Data) to Lowercase Hex String, which is <code>PostData_</code>.', res_title: 'Response Parameters', res_desc: 'Response contains Status, Message, and Result (JSON).', res_status_name: 'Status', res_status_note: '1. Returns <b>SUCCESS</b> if successful.<br>2. Returns error code if failed (see Error Codes).', res_msg_name: 'Message', res_msg_note: 'Text description of the result.', res_result_name: 'Result Data', res_result_note: 'JSON format containing details.', res_obj_title: 'Result Object Parameters', res_mid_name: 'Merchant ID', res_mid_note: 'Merchant ID', res_amt_name: 'Amount', res_amt_note: 'Transaction Amount', res_trade_name: 'Trade No', res_trade_note: 'NewebPay Trade No', res_ord_name: 'Merchant Order No', res_ord_note: 'Merchant Order No', err_title: 'Error Codes', err_search_ph: 'Search code (e.g. TRA10039) or reason...', th_err_code: 'Error Code', th_err_reason: 'Reason / Note', err_MPG01002: 'TimeStamp cannot be empty', err_MPG01009: 'MerchantID cannot be empty', err_MPG01010: 'Version setting error', err_MPG01011: 'RespondType setting error', err_MPG01012: 'MerchantOrderNo invalid/empty (Alphanumeric/Underscore, max 30 chars)', err_MPG01023: 'Encrypted data cannot be empty (TradeInfo/PostData_)', err_MPG01024: 'SHA data cannot be empty (TradeSha)', err_MEM40008: 'Required fields cannot be empty', err_MEM40012: 'Required field transmission error (PostData_ empty)', err_MEM40013: 'Required field data incomplete', err_MEM40014: 'Transmission time error', err_NOR1001: 'Connection abnormal', err_TRA10001: 'Failed to get merchant data', err_TRA10003: 'Amount must be a number', err_TRA10008: 'Data encryption error (PostData_ decrypt failed)', err_TRA10009: 'MerchantID cannot be empty', err_TRA10012: 'MerchantID disabled', err_TRA10013: 'Merchant credit card qualification disabled', err_TRA10015: 'Network connection failed', err_TRA10018: 'Insufficient data', err_TRA10021: 'Transaction not found or not a credit card transaction', err_TRA10026: 'Order not authorized successfully, cannot capture', err_TRA10027: 'Order already captured, cannot repeat', err_TRA10028: 'Capture/Refund amount exceeds auth amount', err_TRA10029: 'Capture period expired (N days)', err_TRA10030: 'Add capture/refund data failed', err_TRA10031: 'UnionPay only accepts full amount capture/refund', err_TRA10032: 'IndexType must be 1 or 2', err_TRA10033: 'MerchantOrderNo cannot be empty if selected', err_TRA10035: 'Transaction not authorized or already captured', err_TRA10036: 'RespondType format error or amount exceeded', err_TRA10037: 'MerchantOrderNo format error (Alphanumeric/_ only)', err_TRA10038: 'System TradeNo format error', err_TRA10039: 'Refund amount exceeds captured amount', err_TRA10045: 'Transaction refunding or failed', err_TRA10046: 'Disbursement status abnormal, cannot refund', err_TRA10047: 'Transaction not auth success (cannot void) or not disbursed (cannot refund)', err_TRA10048: 'Transaction is capturing', err_TRA10049: 'Transaction is refunding', err_TRA10050: 'Amount mismatch', err_TRA10058: 'DCC transaction only accepts full capture', err_TRA10070: 'UnionPay does not require capture', err_TRA10678: 'UnionPay refund failed', err_TRA10675: 'Bonus transaction only accepts full capture/refund', err_TRA10702: 'Limit reached, please try again in 1 hour', err_TRA11002: 'Too many failures, please try again in 4 hours', err_TRA20001: 'Bank batch processing cancel auth', err_TRA20002: 'Transaction data not found', err_TRA20004: 'MerchantOrderNo duplicate', err_TRA20011: 'Transaction already captured', err_TRA20027: 'Refund already applied, processing', err_TRA40014: 'TimeStamp field error', err_1101: 'Refund failed', err_1102: 'Merchant not found', err_1103: 'Order data not found', err_1104: 'Order status not refundable', err_1105: 'Insufficient refundable amount', err_1107: 'Not captured yet', err_1108: 'Full refund only supported', err_1109: 'Refund application in progress', err_1116: 'Insufficient refundable amount, see FAQ', err_2100: 'The Amount minimum is 1', err_4101: 'EncryptData_ cannot be empty', err_4102: 'HashData_ cannot be empty', err_4103: 'HashData_ check mismatch', err_4104: 'Encryption data error, check Hash_Key/IV', err_4105: 'TimeStamp empty', err_4106: 'UID_ cannot be empty', err_9000: 'Network connection failed', example_title: 'Code Example' } },      
            'KO': { name: '한국어', data: { page_title: 'NewebPay - 신용카드 매입/환불/취소 API 문서', header_mobile_title: '매입/환불 API 문서', sidebar_brand: 'NewebPay', sidebar_subtitle: '신용카드 Close API', sidebar_version_note: '(CreditCard/Close)', nav_intro: '개요 및 기능', nav_setup: '연동 사전 준비', nav_tool: '암호화 테스트 도구', nav_group_api: 'API 사양', nav_request: '요청 파라미터 (Request)', nav_encryption: '암호화 규칙 상세', nav_response: '응답 파라미터 (Response)', nav_errors: '오류 코드표', nav_example: '예제 코드', intro_title: '개요 및 기능', intro_desc: '이 API (Close API)는 가맹점이 승인된 신용카드 거래에 대해 후속 처리를 할 수 있도록 지원합니다. 매입, 환불, 매입 취소, 환불 취소의 4가지 기능을 제공하며, 파라미터 조합(CloseType 및 Cancel)을 통해 동작을 결정합니다.', intro_funcs_title: '지원 기능', card_capture_title: '신용카드 매입', card_refund_title: '신용카드 환불', card_cancel_capture_title: '매입 취소', card_cancel_refund_title: '환불 취소', setup_title: '연동 사전 준비', setup_card1_title: '키(Key) 발급', setup_card1_desc: 'NewebPay 가맹점 관리자 페이지에서 상점 아이디(MerchantID)와 해당 <code>Hash Key</code> 및 <code>Hash IV</code>를 확인해야 합니다.', setup_card2_title: 'URL 확인', setup_card2_desc: '테스트 환경: https://ccore.newebpay.com/API/CreditCard/Close<br>운영 환경: https://core.newebpay.com/API/CreditCard/Close', tool_title: '암호화 테스트 도구', tool_intro: '이 도구는 PostData_ 암호화 문자열을 생성하거나 응답 결과를 복호화하는 데 도움을 줍니다.', tool_tab_encrypt: 'AES 암호화 (Request)', tool_tab_decrypt: 'AES 복호화 (Response)', tool_ph_key: '예: AAAAvw3YlqoEk6G4HqRKDAYpHKZWxBBB', tool_ph_iv: '예: AAAACC1FplieBBBB', tool_lbl_qs: '원본 요청 문자열 (Query String)', tool_ph_qs: '예: RespondType=JSON&Version=1.1&Amt=30&MerchantOrderNo=ORD12345&TimeStamp=1400137200&IndexType=1&CloseType=1', tool_note_urlencode: '문자열이 http_build_query 또는 urlencode 처리되었는지 확인하십시오.', tool_btn_encrypt: '암호화 실행 (PostData_ 생성)', tool_lbl_hex: '암호화 결과 (Hex String)', tool_lbl_enc_hex: '암호화된 문자열 (Hex String)', tool_ph_enc_hex: '예: 0ef82edabaf8964d09992d7ec8e575f1...', tool_btn_decrypt: '복호화 실행', tool_lbl_decrypt_res: '복호화 결과 (Raw Data)', req_title: '요청 파라미터 (Request)', req_api_info: 'API 정보', req_url_prod: 'URL (운영)', req_url_test: 'URL (테스트)', req_lvl1_title: '1단계 파라미터 (HTML Form Post)', th_param: '파라미터명', th_name: '명칭', th_required: '필수', th_type: '타입', th_note: '비고', param_mid_name: '상점 아이디', param_mid_note: 'NewebPay 상점 아이디 (MerchantID).', param_post_name: '암호화 데이터', param_post_note: '파라미터를 연결 후, AES-256-CBC로 암호화하고 Hex 문자열로 변환.', req_lvl2_title: 'PostData_ 포함 파라미터 (암호화 전)', p_respt_name: '응답 형식', p_respt_note: '<code class="bg-slate-100 px-1">JSON</code>을 입력하십시오.', p_ver_name: '연동 버전', p_ver_note: '<code class="bg-slate-100 px-1">1.1</code>로 고정하십시오.', p_amt_name: '요청 금액', p_amt_note: '1. 기호 없는 숫자만 입력.<br>2. <b>일시불 (3대 Pay/해외 카드 포함)</b>: 전체 및 부분 매입/환불 가능.<br>3. <b>할부 및 포인트 사용</b>: <span class="text-red-600 font-bold">전체</span> 금액 매입/환불만 가능.<br>4. <b>은련카드(UnionPay)</b>: 전체 금액 매입만 가능, 단 전체 및 부분 환불은 가능.', p_ord_name: '상점 주문 번호', p_ord_note: '1. 동일 상점 내에서 중복될 수 없습니다.<br>2. 영문, 숫자, 밑줄(_)만 허용.', p_ts_name: '타임스탬프', p_ts_note: 'Unix 타임스탬프 (초).<br><span class="text-red-600">※ 현재 시간을 정확히 입력해야 하며, 오차 120초 초과 시 거래 실패.</span>', p_idx_name: '선택 주문번호 유형', p_idx_note: '<b>1</b>: 상점 주문 번호 사용 (MerchantOrderNo)<br><b>2</b>: NewebPay 거래 번호 사용 (TradeNo)<br>※ 선택한 유형의 번호는 비어 있을 수 없습니다.', p_trade_name: 'NewebPay 거래 번호', p_trade_note: 'NewebPay 플랫폼 거래 번호 (IndexType=2 인 경우 필수).', p_close_note: '<b>1</b>: 매입 (Capture) 또는 매입 취소.<br><b>2</b>: 환불 (Refund) 또는 환불 취소.', p_close_name: '매입/환불 구분', p_cancel_name: '취소 동작', p_cancel_note: '<b>매입 취소</b> 또는 <b>환불 취소</b>를 원할 경우 <b>1</b>을 입력.<br>(일반 매입 또는 환불인 경우 공란).', p_proc_name: '사용자 정의 처리 번호', p_proc_note: '가맹점이 이번 작업을 위해 정의한 처리 번호.', enc_title: '암호화 규칙 상세', enc_aes_title: 'AES 암복호화 메커니즘 (PostData_)', enc_aes_desc: '중요 거래 정보 유출 방지를 위해, 암호화 전 상점의 Hash Key와 Hash IV를 사용하여 파라미터 문자열을 AES 암호화해야 합니다.', enc_step1_title: '요청 문자열 생성', enc_step1_desc: '모든 파라미터를 <code>http_build_query</code> 형식으로 조합 (key=value&key2=value2...).', enc_step2_title: 'AES 암호화', enc_step2_desc: '알고리즘: <span class="font-bold text-red-600">AES-256-CBC</span><br>패딩 (Padding): <span class="font-bold text-red-600">PKCS7</span><br>Key / IV: 상점 전용 Hash Key와 Hash IV 사용.', enc_step3_title: 'Hex 변환', enc_step3_desc: '암호화된 이진 데이터(Raw Data)를 소문자 Hex String으로 변환하면 <code>PostData_</code>가 됩니다.', res_title: '응답 파라미터 (Response)', res_desc: '응답 데이터는 Status, Message, Result (JSON)를 포함합니다.', res_status_name: '상태', res_status_note: '1. 성공 시 <b>SUCCESS</b> 반환.<br>2. 실패 시 오류 코드 반환 (오류 코드표 참조).', res_msg_name: '메시지', res_msg_note: '결과에 대한 텍스트 설명.', res_result_name: '결과 데이터', res_result_note: '상세 정보를 포함한 JSON 형식.', res_obj_title: 'Result 객체 포함 파라미터', res_mid_name: '상점 아이디', res_mid_note: '상점 아이디', res_amt_name: '금액', res_amt_note: '거래 금액', res_trade_name: '거래 번호', res_trade_note: 'NewebPay 거래 번호', res_ord_name: '상점 주문 번호', res_ord_note: '상점 주문 번호', err_title: '오류 코드표', err_search_ph: '코드(예: TRA10039) 또는 원인 검색...', th_err_code: '오류 코드', th_err_reason: '원인 / 비고', err_MPG01002: 'TimeStamp는 비어 있을 수 없습니다', err_MPG01009: 'MerchantID는 비어 있을 수 없습니다', err_MPG01010: '프로그램 버전 설정 오류', err_MPG01011: 'RespondType 설정 오류', err_MPG01012: 'MerchantOrderNo 비어있음/오류 (영숫자, 밑줄, 30자 제한)', err_MPG01023: '거래 암호화 데이터 누락 (TradeInfo/PostData_)', err_MPG01024: '거래 SHA 데이터 누락 (TradeSha)', err_MEM40008: '필수 필드가 비어 있습니다', err_MEM40012: '필수 필드 전송 오류 (PostData_ 공란)', err_MEM40013: '필수 필드 데이터 불충분', err_MEM40014: '전송 시간 오류', err_NOR1001: '연결 이상', err_TRA10001: '상점 정보 가져오기 실패', err_TRA10003: '금액은 숫자여야 합니다', err_TRA10008: '데이터 암호화 오류 (PostData_ 복호화 실패)', err_TRA10009: 'MerchantID 누락', err_TRA10012: '상점 아이디 사용 중지됨', err_TRA10013: '상점 신용카드 자격 정지됨', err_TRA10015: '네트워크 연결 실패', err_TRA10018: '데이터 부족', err_TRA10021: '거래를 찾을 수 없거나 신용카드 거래가 아님', err_TRA10026: '주문이 승인 성공 상태가 아니므로 매입 불가', err_TRA10027: '이미 매입 신청된 주문입니다', err_TRA10028: '매입/환불 금액이 승인 금액을 초과함', err_TRA10029: '매입 기한(N일) 초과', err_TRA10030: '매입/환불 데이터 추가 실패', err_TRA10031: '은련카드는 전액 매입/환불만 가능', err_TRA10032: 'IndexType은 1 또는 2여야 함', err_TRA10033: '선택 시 MerchantOrderNo는 비어 있을 수 없음', err_TRA10035: '거래가 승인 성공 상태가 아니거나 이미 매입 완료됨', err_TRA10036: 'RespondType 형식 오류 또는 금액 초과', err_TRA10037: '상점 주문 번호 오류 (영숫자/_ 만 허용)', err_TRA10038: '시스템 거래 번호 형식 오류', err_TRA10039: '환불 금액이 매입 금액을 초과함', err_TRA10045: '거래가 환불 중이거나 실패함', err_TRA10046: '지급 상태 이상으로 환불 불가', err_TRA10047: '거래 미승인(취소 불가) 또는 미지급(환불 불가)', err_TRA10048: '거래가 매입 진행 중', err_TRA10049: '거래가 환불 진행 중', err_TRA10050: '금액 불일치', err_TRA10058: 'DCC 거래는 전액 매입만 허용', err_TRA10070: '은련카드는 매입 불필요', err_TRA10678: '은련카드 환불 실패', err_TRA10675: '포인트 거래는 전액 매입/환불만 허용', err_TRA10702: '한도 도달, 1시간 후 다시 시도하십시오', err_TRA11002: '실패 과다, 4시간 후 다시 시도하십시오', err_TRA20001: '금융기관 승인 취소 배치 처리 중', err_TRA20002: '거래 데이터 없음', err_TRA20004: '상점 주문 번호 중복', err_TRA20011: '해당 거래는 이미 매입됨', err_TRA20027: '이미 환불 신청됨, 처리 중', err_TRA40014: 'TimeStamp 필드 오류', err_1101: '환불 실패', err_1102: '상점을 찾을 수 없음', err_1103: '주문 데이터 없음', err_1104: '환불 가능한 주문 상태가 아님', err_1105: '환불 가능 금액 부족', err_1107: '아직 매입되지 않음', err_1108: '전액 환불만 지원됨', err_1109: '환불 신청 진행 중', err_1116: '환불 가능 금액 부족, FAQ 참조', err_2100: '최소 금액은 1입니다', err_4101: 'EncryptData_는 공란일 수 없음', err_4102: 'HashData_는 공란일 수 없음', err_4103: 'HashData_ 검증 불일치', err_4104: '암호화 데이터 오류, Hash_Key/IV 확인', err_4105: 'TimeStamp 공란', err_4106: 'UID_는 공란일 수 없음', err_9000: '네트워크 연결 실패', example_title: '예제 코드' } },        
        
        };

        const errorCodes = [
            'MPG01002', 'MPG01009', 'MPG01010', 'MPG01011', 'MPG01012', 'MPG01023', 'MPG01024',
            'MEM40008', 'MEM40012', 'MEM40013', 'MEM40014', 'NOR1001',
            'TRA10001', 'TRA10003', 'TRA10008', 'TRA10009', 'TRA10012', 'TRA10013', 'TRA10015',
            'TRA10018', 'TRA10021', 'TRA10026', 'TRA10027', 'TRA10028', 'TRA10029', 'TRA10030',
            'TRA10031', 'TRA10032', 'TRA10033', 'TRA10035', 'TRA10036', 'TRA10037', 'TRA10038',
            'TRA10039', 'TRA10045', 'TRA10046', 'TRA10047', 'TRA10048', 'TRA10049', 'TRA10050',
            'TRA10058', 'TRA10070', 'TRA10678', 'TRA10675', 'TRA10702', 'TRA11002', 'TRA20001',
            'TRA20002', 'TRA20004', 'TRA20011', 'TRA20027', 'TRA40014',
            '1101', '1102', '1103', '1104', '1105', '1107', '1108', '1109', '1116', '2100',
            '4101', '4102', '4103', '4104', '4105', '4106', '9000'
        ];

        const codeExamples = {
            php: `<?php
// 1. Setup Merchant Info
$hashKey    = "YourHashKey"; 
$hashIV     = "YourHashIV";  
$merchantID = "MS12345678";  
// API URL
$apiUrl     = "https://core.newebpay.com/API/CreditCard/Close";

// 2. Prepare Parameters (Example: Capture)
$params = [
    'RespondType'     => 'JSON',
    'Version'         => '1.1',
    'Amt'             => '1000',
    'MerchantOrderNo' => 'ORD_' . time(),
    'TimeStamp'       => time(),
    'IndexType'       => '1', // 1: Use MerchantOrderNo
    'CloseType'       => '1', // 1: Capture, 2: Refund
    // 'Cancel'       => '1', // Set to 1 to Cancel Capture/Refund
];

// 3. Generate Query String
$dataString = http_build_query($params);

// 4. AES-256-CBC Encryption
$encrypted = openssl_encrypt(
    $dataString, 
    'AES-256-CBC', 
    $hashKey, 
    OPENSSL_RAW_DATA, 
    $hashIV
);
$postData = bin2hex($encrypted);
?>

<form method="post" action="<?php echo $apiUrl; ?>">
    <input type="hidden" name="MerchantID_" value="<?php echo $merchantID; ?>">
    <input type="hidden" name="PostData_" value="<?php echo $postData; ?>">
    <input type="submit" value="Submit Request">
</form>`,
            nodejs: `const crypto = require('crypto');
const querystring = require('querystring');
const axios = require('axios');

// 1. Setup Info
const hashKey = 'YourHashKey';
const hashIV  = 'YourHashIV';
const merchantID = 'MS12345678';
const apiUrl = 'https://core.newebpay.com/API/CreditCard/Close';

// 2. Prepare Params
const params = {
    RespondType: 'JSON',
    Version: '1.1',
    Amt: '1000',
    MerchantOrderNo: 'ORD_' + Date.now(),
    TimeStamp: Math.floor(Date.now() / 1000),
    IndexType: '1',
    CloseType: '1'
};

// 3. Convert to Query String
const dataString = querystring.stringify(params);

// 4. AES Encryption
const cipher = crypto.createCipheriv('aes-256-cbc', hashKey, hashIV);
let encrypted = cipher.update(dataString, 'utf8', 'hex');
encrypted += cipher.final('hex');

// 5. Send POST Request
axios.post(apiUrl, querystring.stringify({
    MerchantID_: merchantID,
    PostData_: encrypted
}), {
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
}).then(res => {
    console.log(res.data);
}).catch(err => {
    console.error(err);
});`,
            python: `import time
import urllib.parse
import requests
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
import binascii

# 1. Setup Info
hash_key = b'YourHashKey' # bytes
hash_iv  = b'YourHashIV'  # bytes
merchant_id = 'MS12345678'
api_url = 'https://core.newebpay.com/API/CreditCard/Close'

# 2. Prepare Params
params = {
    'RespondType': 'JSON',
    'Version': '1.1',
    'Amt': '1000',
    'MerchantOrderNo': f'ORD_{int(time.time())}',
    'TimeStamp': int(time.time()),
    'IndexType': '1',
    'CloseType': '1'
}

# 3. Convert to Query String
data_string = urllib.parse.urlencode(params)

# 4. AES Encryption
cipher = AES.new(hash_key, AES.MODE_CBC, hash_iv)
encrypted_bytes = cipher.encrypt(pad(data_string.encode('utf-8'), AES.block_size))
post_data = binascii.hexlify(encrypted_bytes).decode('utf-8')

# 5. Send POST Request
payload = {
    'MerchantID_': merchant_id,
    'PostData_': post_data
}
response = requests.post(api_url, data=payload)
print(response.text)`,
            csharp: `using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Security.Cryptography;
using System.Text;
using System.Web;

public class Program
{
    public static async Task Main()
    {
        string hashKey = "YourHashKey";
        string hashIV = "YourHashIV";
        string merchantID = "MS12345678";
        string apiUrl = "https://core.newebpay.com/API/CreditCard/Close";

        // Prepare Params
        var paramsDict = new Dictionary<string, string>
        {
            { "RespondType", "JSON" },
            { "Version", "1.1" },
            { "Amt", "1000" },
            { "MerchantOrderNo", "ORD_" + DateTimeOffset.Now.ToUnixTimeSeconds() },
            { "TimeStamp", DateTimeOffset.Now.ToUnixTimeSeconds().ToString() },
            { "IndexType", "1" },
            { "CloseType", "1" }
        };

        // To Query String
        string dataString = string.Join("&", paramsDict.Select(p => $"{p.Key}={HttpUtility.UrlEncode(p.Value)}"));

        // Encrypt
        string postData = EncryptAES256(dataString, hashKey, hashIV);

        // Send Request
        using (var client = new HttpClient())
        {
            var content = new FormUrlEncodedContent(new[]
            {
                new KeyValuePair<string, string>("MerchantID_", merchantID),
                new KeyValuePair<string, string>("PostData_", postData)
            });

            var response = await client.PostAsync(apiUrl, content);
            string result = await response.Content.ReadAsStringAsync();
            Console.WriteLine(result);
        }
    }

    public static string EncryptAES256(string source, string key, string iv)
    {
        byte[] sourceBytes = Encoding.UTF8.GetBytes(source);
        using (var aes = Aes.Create())
        {
            aes.Mode = CipherMode.CBC;
            aes.Padding = PaddingMode.PKCS7;
            aes.Key = Encoding.UTF8.GetBytes(key);
            aes.IV = Encoding.UTF8.GetBytes(iv);

            using (var encryptor = aes.CreateEncryptor())
            {
                byte[] encryptedBytes = encryptor.TransformFinalBlock(sourceBytes, 0, sourceBytes.Length);
                return BitConverter.ToString(encryptedBytes).Replace("-", "").ToLower();
            }
        }
    }
}`
        };

        // 1. 取得網址參數
        const urlParams = new URLSearchParams(window.location.search);
        const getLang = urlParams.get('lang');

        // 2. 檢查參數是否存在且有效 (是否在 langData 定義中)
        // 如果有效就用參數值，否則預設為 'zh-TW'
        let currentLang = (getLang && langData[getLang]) ? getLang : 'zh-TW';
        let currentCodeTab = 'php';

        function applyTranslations(lang = 'zh-TW') {
            const data = langData[lang]?.data;
            if (!data) return;

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (data[key]) {
                    el.innerHTML = data[key];
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (data[key]) {
                    el.setAttribute('placeholder', data[key]);
                }
            });
            
            // Update html lang attribute
            document.documentElement.lang = lang;
        }

        function initLangDropdown() {
            const select = document.getElementById('lang-select');
            const languages = Object.keys(langData);
            if (languages.length === 0) return;

            select.innerHTML = '';
            languages.forEach(langKey => {
                const option = document.createElement('option');
                option.value = langKey;
                option.textContent = langData[langKey].name;
                if(langKey === currentLang) option.selected = true;
                select.appendChild(option);
            });
        }

        function changeLang(targetLang) {
            currentLang = targetLang;
            applyTranslations(targetLang);
            renderErrorTable(); // Re-render error table with new lang
            loadCode(currentCodeTab); // Re-load code with new lang comments
        }

        function renderErrorTable() {
            const tbody = document.querySelector('#errorTable tbody');
            if (!tbody) return;
            
            const data = langData[currentLang].data;

            tbody.innerHTML = '';
            const html = errorCodes.map(code => {
                const i18nKey = `err_${code}`;
                const text = data[i18nKey] || '';
                return `<tr>
                    <td class="px-6 py-2 font-bold text-red-600">${code}</td>
                    <td class="px-6 py-2" data-i18n="${i18nKey}">${text}</td>
                </tr>`;
            }).join('');
            tbody.innerHTML = html;
        }

        window.onload = function() {
            initLangDropdown();
            applyTranslations(currentLang);
            renderErrorTable();
            loadCode(currentCodeTab);
        };

        function switchTab(lang, event) {
            document.querySelectorAll('#example .tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            currentCodeTab = lang;
            loadCode(lang);
        }

        function loadCode(lang) {
            const display = document.getElementById('code-display');
            
            // Ensure lang has a value, default to 'php'
            if (!lang) lang = 'php';

            // Directly access global codeExamples, independent of currentLang
            display.value = codeExamples[lang] || "// Code example not available.";
        }

        function switchToolTab(tabId) {
            document.querySelectorAll('.tool-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tool-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tool-tab-btn').forEach(el => {
                el.classList.remove('active', 'border-purple-600', 'text-purple-600');
                el.classList.add('border-transparent', 'text-slate-500');
            });

            const targetContent = document.getElementById(tabId);
            targetContent.classList.remove('hidden');
            targetContent.classList.add('active');

            const btn = event.currentTarget;
            btn.classList.remove('border-transparent', 'text-slate-500');
            btn.classList.add('active', 'border-purple-600', 'text-purple-600');
        }

        const menuBtn = document.getElementById('menu-btn');
        const sidebar = document.getElementById('sidebar');
        let isMenuOpen = false;

        menuBtn.addEventListener('click', () => {
            isMenuOpen = !isMenuOpen;
            sidebar.classList.toggle('-translate-x-full');
        });

        const searchInput = document.getElementById('errorSearch');
        searchInput.addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase();
            const tableRows = document.querySelectorAll('#errorTable tbody tr');
            tableRows.forEach(row => {
                const code = row.children[0].textContent.toLowerCase();
                const msg = row.children[1].textContent.toLowerCase();
                if (code.includes(term) || msg.includes(term)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // AES Tools
        function getKeys() {
            const key = document.getElementById('toolKey').value.trim();
            const iv = document.getElementById('toolIv').value.trim();
            if (!key || !iv) {
                // Simple alert fallback translation
                const msg = currentLang === 'zh-TW' ? '請輸入 Hash Key 與 Hash IV' : 'Please enter Hash Key and Hash IV';
                alert(msg);
                return null;
            }
            return { key, iv };
        }

        function runEncrypt() {
            const keys = getKeys();
            if (!keys) return;
            const data = document.getElementById('encryptInput').value.trim();
            if (!data) {
                const msg = currentLang === 'zh-TW' ? '請輸入原始字串' : 'Please enter original string';
                return alert(msg);
            }

            try {
                const keyHex = CryptoJS.enc.Utf8.parse(keys.key);
                const ivHex = CryptoJS.enc.Utf8.parse(keys.iv);

                const encrypted = CryptoJS.AES.encrypt(data, keyHex, {
                    iv: ivHex,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });

                document.getElementById('encryptOutput').value = encrypted.ciphertext.toString(CryptoJS.enc.Hex);
            } catch (e) {
                console.error(e);
                const msg = currentLang === 'zh-TW' ? '加密失敗: ' : 'Encryption failed: ';
                alert(msg + e.message);
            }
        }

        function runDecrypt() {
            const keys = getKeys();
            if (!keys) return;
            const hexStr = document.getElementById('decryptInput').value.trim();
            if (!hexStr) {
                 const msg = currentLang === 'zh-TW' ? '請輸入加密後的 Hex 字串' : 'Please enter Encrypted Hex String';
                 return alert(msg);
            }

            try {
                const keyHex = CryptoJS.enc.Utf8.parse(keys.key);
                const ivHex = CryptoJS.enc.Utf8.parse(keys.iv);
                
                const encryptedHex = CryptoJS.enc.Hex.parse(hexStr);
                const encryptedBase64 = CryptoJS.enc.Base64.stringify(encryptedHex);

                const decrypted = CryptoJS.AES.decrypt(encryptedBase64, keyHex, {
                    iv: ivHex,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });

                document.getElementById('decryptOutput').value = decrypted.toString(CryptoJS.enc.Utf8);
            } catch (e) {
                console.error(e);
                const msg = currentLang === 'zh-TW' ? '解密失敗，請檢查 Key/IV 或加密字串格式' : 'Decryption failed. Check Key/IV or format.';
                alert(msg);
            }
        }

        // Scroll Spy
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');
            let current = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 50) {
                 if (sections.length > 0) {
                     current = sections[sections.length - 1].getAttribute('id');
                 }
            }

            navLinks.forEach(link => {
                link.classList.remove('sidebar-active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('sidebar-active');
                }
            });
        });
    </script>
</body>
</html>